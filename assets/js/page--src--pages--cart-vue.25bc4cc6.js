(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{"8pOP":function(e,t,o){},"9o6m":function(e,t,o){"use strict";o.r(t);o("fbCW"),o("sMBO"),o("tkto"),o("ls82");var i=o("HaE+"),s=o("uFwe"),n=o("vDqi"),r=o.n(n),a={name:"CartPart",props:{exhibitor:Object,exhibitorCart:Object,open:Boolean},computed:{cartOptions:function(){return this.$store.state.cartOptions[this.exhibitor.code]||this.options}},data:function(){return{options:{payment:{},delivery:{}}}},watch:{cartOptions:{handler:function(e){this.options=e},deep:!0,immediate:!0},options:{handler:function(e){this.$store.commit("updateCartOptions",{code:this.exhibitor.code,options:e})},deep:!0}},methods:{remove:function(e){this.$store.commit("removeFromCart",{product:e})},changeQuantity:function(e,t){this.$store.commit("updateCart",{product:t,quantity:e})}}},c=o("KHd+"),l={components:{CartPart:Object(c.a)(a,(function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("keep-alive",[o("b-collapse",{staticClass:"card orders",attrs:{open:e.open,animation:"slide"},on:{open:function(t){return e.$emit("open",t)}},scopedSlots:e._u([{key:"trigger",fn:function(t){return o("div",{staticClass:"card-header",attrs:{role:"button"}},[o("span",{staticClass:"card-header-title"},[e._t("title")],2),o("a",{staticClass:"card-header-icon"},[o("b-icon",{attrs:{icon:t.open?"menu-down":"menu-up"}})],1)])}}],null,!0)},[o("div",{staticClass:"card-content"},[o("div",{staticClass:"content"},[o("table",{staticClass:"table"},[o("tr",[o("th",[e._v(e._s(e.$tc("product._",1)))]),o("th",[e._v(e._s(e.$t("cart.unit-price")))]),o("th",[e._v(e._s(e.$t("cart.quantity")))]),o("th",[e._v(e._s(e.$t("cart.price")))]),o("th")]),e._l(e.exhibitorCart.items,(function(t){return o("tr",{key:t.product.id},[o("td",[e._v(e._s(t.product.name))]),o("td",[e._v(e._s(e._f("formatNumber")(t.product.price))+" €")]),o("td",[o("b-numberinput",{staticClass:"nbInput",attrs:{type:"is-info",size:"is-small","controls-position":"compact","controls-rounded":"",editable:!1,min:"1",value:t.quantity},on:{input:function(o){return e.changeQuantity(o,t.product)}}})],1),o("td",[e._v(e._s(e._f("formatNumber")(t.quantity*t.product.price))+" €")]),o("td",[o("b-button",{staticClass:"deleteBtn",attrs:{type:"is-info",size:"is-small","icon-left":"delete",outlined:"",rounded:""},on:{click:function(o){return o.preventDefault(),e.remove(t.product)}}})],1)])})),o("tr",[o("th",{attrs:{colspan:"3"}},[e._v(e._s(e.$t("cart.total")))]),o("td",[e._v(e._s(e._f("formatNumber")(e.$store.getters.totalPrice(e.exhibitor.code)))+" €")]),o("td")])],2),o("div",[o("h4",{staticClass:"title is-4"},[e._v(e._s(e.$t("cart.options")))]),o("div",{staticClass:"columns"},[o("div",{staticClass:"column is-one-fifth"},[o("b-icon",{attrs:{icon:"credit-card-outline",size:"is-small"}}),e._v(" "+e._s(e.$t("payment._"))+"\n            ")],1),o("div",{staticClass:"column is-two-fifth"},[o("b-select",{attrs:{expanded:""},model:{value:e.options.payment.mean,callback:function(t){e.$set(e.options.payment,"mean",t)},expression:"options.payment.mean"}},e._l(e.exhibitor.payment,(function(t){return o("option",{key:t,domProps:{value:t}},[e._v(e._s(e.$t("payment."+t)))])})),0)],1),o("div",{staticClass:"column is-two-fifth"})]),o("div",{staticClass:"columns"},[o("div",{staticClass:"column is-one-fifth"},[o("b-icon",{attrs:{icon:"truck-delivery",size:"is-small"}}),e._v(" "+e._s(e.$t("delivery._"))+"\n            ")],1),o("div",{staticClass:"column is-two-fifth"},[o("b-select",{attrs:{expanded:""},model:{value:e.options.delivery.mean,callback:function(t){e.$set(e.options.delivery,"mean",t)},expression:"options.delivery.mean"}},e._l(e.exhibitor.delivery,(function(t){return o("option",{key:t,domProps:{value:t}},[e._v(e._s(e.$t("delivery."+t)))])})),0),"delivery"===e.options.delivery.mean&&e.exhibitor.deliveryCondition?o("p",[o("i",[e._v(e._s(e.exhibitor.deliveryCondition))])]):e._e()],1),o("div",{staticClass:"column is-two-fifth"},["pickup"===e.options.delivery.mean?o("b-select",{attrs:{expanded:""},model:{value:e.options.delivery.pickupLocation,callback:function(t){e.$set(e.options.delivery,"pickupLocation",t)},expression:"options.delivery.pickupLocation"}},e._l(e.exhibitor.pickUpRelay,(function(t,i){return o("option",{key:i},[e._v(e._s(t))])})),0):e._e(),"postmail"===e.options.delivery.mean||"delivery"===e.options.delivery.mean?o("b-input",{attrs:{icon:"map-marker"},model:{value:e.options.delivery.address,callback:function(t){e.$set(e.options.delivery,"address",t)},expression:"options.delivery.address"}}):e._e(),"store"===e.options.delivery.mean?o("b-select",{attrs:{expanded:""},model:{value:e.options.delivery.selectedStore,callback:function(t){e.$set(e.options.delivery,"selectedStore",t)},expression:"options.delivery.selectedStore"}},e._l(e.exhibitor.store,(function(t,i){return o("option",{key:i},[e._v(e._s(t))])})),0):e._e()],1)])])])])])],1)}),[],!1,null,null,null).exports},metaInfo:{title:"Cart"},data:function(){return{opened:-1,isConfirmDialogOpen:!1,placingOrder:!1,conditionsAccepted:!1,customer:{name:"",email:"",phone:""}}},computed:{nbExhibitors:function(){return Object.keys(this.structuredCart).length},structuredCart:function(){var e,t={},o=Object(s.a)(this.$store.state.cart);try{for(o.s();!(e=o.n()).done;){var i=e.value,n=i.product.exhibitor.code;n in t||(t[n]={name:i.product.exhibitor.name,items:[]}),t[n].items.push(i)}}catch(e){o.e(e)}finally{o.f()}return t},exhibitors:function(){for(var e=this,t={},o=function(){var o=s[i];t[o]=e.$page.data.exhibitors.find((function(e){return e.code===o}))},i=0,s=Object.keys(this.structuredCart);i<s.length;i++)o();return t}},methods:{emptyCart:function(){var e=this;this.$buefy.dialog.confirm({message:this.$t("cart.confirm-empty"),onConfirm:function(){return e.$store.commit("emptyCart")}})},confirmOrder:function(){for(var e=!0,t=0,o=Object.keys(this.structuredCart);t<o.length;t++){var i=o[t],s=this.$store.state.cartOptions[i];if(!(s&&s.payment&&s.payment.mean&&s.delivery&&s.delivery.mean)){e=!1;break}switch(s.delivery.mean){case"delivery":case"postmail":s.delivery.address||(e=!1);break;case"pickup":s.delivery.pickupLocation||(e=!1);break;case"store":s.delivery.selectedStore||(e=!1)}}e?this.isConfirmDialogOpen=!0:this.$buefy.toast.open({duration:5e3,message:"Les moyens de paiement et de livraison ne sont pas définis pour tous les exposant(e)s.",position:"is-top",type:"is-danger"})},placeOrder:function(){var e=this;return Object(i.a)(regeneratorRuntime.mark((function t(){var o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.customer&&e.customer.name&&e.customer.email){t.next=3;break}return e.$buefy.toast.open({duration:5e3,message:"Vous devez au moins renseigner votre nom et votre adresse e-mail.",position:"is-top",type:"is-danger"}),t.abrupt("return");case 3:if(e.conditionsAccepted){t.next=6;break}return e.$buefy.toast.open({duration:5e3,message:"Vous devez accepter les conditions pour pouvoir envoyer votre(vos) commande(s) aux exposant(e)s.",position:"is-top",type:"is-danger"}),t.abrupt("return");case 6:return e.placingOrder=!0,t.next=9,e.$recaptchaLoaded();case 9:return t.next=11,e.$recaptcha("Order");case 11:return o=t.sent,t.prev=12,t.next=15,r.a.post("https://api.christmas-market.be/placeorder",{token:o,cart:JSON.stringify(e.structuredCart),options:e.$store.state.cartOptions,customer:e.customer});case 15:t.sent,e.$buefy.dialog.alert({title:"Commande envoyée",message:"Votre commande a été envoyée à l'exposant(e) concerné(e), il(elle) vous contactera prochainement pour la finaliser.",type:"is-success",hasIcon:!0,icon:"information",ariaRole:"alertdialog",ariaModal:!0}),e.$store.commit("emptyCart"),t.next=23;break;case 20:t.prev=20,t.t0=t.catch(12),e.$buefy.dialog.alert({title:"Erreur",message:"Une erreur s'est produite et votre commande n'a pas été envoyée, veuillez réessayer plus tard.",type:"is-danger",hasIcon:!0,icon:"alert-circle",ariaRole:"alertdialog",ariaModal:!0});case 23:return t.prev=23,e.placingOrder=!1,e.isConfirmDialogOpen=!1,t.finish(23);case 27:case"end":return t.stop()}}),t,null,[[12,20,23,27]])})))()}}},d=(o("twr/"),null),u=Object(c.a)(l,(function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("Layout",[o("h2",{staticClass:"title is-2"},[e._v(e._s(e.$t("cart._")))]),e.$store.getters.isCartEmpty?o("div",[o("p",[e._v(e._s(e.$t("cart.is-empty")))])]):o("div",[o("p",[e._v(e._s(e.$t("cart.summary",{nbExhibitors:e.nbExhibitors,total:e.$options.filters.formatNumber(e.$store.getters.totalPrice())})))]),e._l(Object.keys(e.structuredCart).sort(),(function(t,i){return o("cart-part",{key:t,attrs:{open:e.opened===i,exhibitor:e.exhibitors[t],exhibitorCart:e.structuredCart[t]},on:{open:function(t){e.opened=i}},scopedSlots:e._u([{key:"title",fn:function(){return[o("p",[e._v(e._s(i+1)+". "+e._s(e.structuredCart[t].name)+" "),o("small",[e._v("("+e._s(e._f("formatNumber")(e.$store.getters.totalPrice(t)))+" €)")])])]},proxy:!0}],null,!0)})})),o("div",{staticClass:"actions"},[o("b-button",{attrs:{type:"is-danger",size:"is-small"},on:{click:e.emptyCart}},[e._v(e._s(e.$t("cart.empty")))]),e._v(" \n      "),o("b-button",{attrs:{type:"is-info",size:"is-small"},on:{click:e.confirmOrder}},[e._v(e._s(e.$tc("cart.place-order",e.nbExhibitors)))])],1),o("b-modal",{attrs:{"has-modal-card":"","trap-focus":"","destroy-on-hide":!1,"aria-role":"dialog","aria-modal":""},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.close;return[o("form",{attrs:{action:""}},[o("div",{staticClass:"modal-card",staticStyle:{width:"auto"}},[o("header",{staticClass:"modal-card-head"},[o("p",{staticClass:"modal-card-title"},[e._v("Confirmation commande")]),o("button",{staticClass:"delete",attrs:{type:"button"},on:{click:i}})]),o("section",{staticClass:"modal-card-body"},[o("b-notification",{attrs:{type:"is-info is-light",icon:"information","has-icon":!0,closable:!1}},[o("p",[e._v("Les montants indiqués dans votre panier sont indicatifs et ne comprennent ni les éventuelles réductions proposées par les exposant(e)s, ni les éventuels frais d'envoi en cas de livraison postale. Hormis ces derniers, les prix définitifs que vous devrez payer ne seront pas plus élevés que ceux mentionnés dans votre panier.")]),o("p",[e._v("Après vérification des stocks, les exposant(e)s prendront contact avec vous, en vous notifiant notamment des prix finaux. Vous serez évidemment libre d'accepter ou refuser la(les) commande(s) à ce moment là.")])]),o("b-field",{attrs:{label:"Nom"}},[o("b-input",{attrs:{type:"text",placeholder:"Votre nom",required:""},model:{value:e.customer.name,callback:function(t){e.$set(e.customer,"name",t)},expression:"customer.name"}})],1),o("b-field",{attrs:{label:"Email"}},[o("b-input",{attrs:{type:"email",placeholder:"Votre adresse e-mail",required:""},model:{value:e.customer.email,callback:function(t){e.$set(e.customer,"email",t)},expression:"customer.email"}})],1),o("b-field",{attrs:{label:"Téléphone/GSM (optionnel)"}},[o("b-input",{attrs:{type:"email",placeholder:"Votre numéro de téléphone"},model:{value:e.customer.phone,callback:function(t){e.$set(e.customer,"phone",t)},expression:"customer.phone"}})],1),o("b-checkbox",{model:{value:e.conditionsAccepted,callback:function(t){e.conditionsAccepted=t},expression:"conditionsAccepted"}},[e._v("J'ai bien compris les conditions reprises ci-dessus")])],1),o("footer",{staticClass:"modal-card-foot"},[e.placingOrder?o("div",[e._v("Envoi de la commande en cours...")]):o("div",{staticClass:"actions"},[o("b-button",{attrs:{type:"is-danger",size:"is-small"},on:{click:i}},[e._v("Annuler")]),o("b-button",{attrs:{type:"is-info",size:"is-small"},on:{click:e.placeOrder}},[e._v("Envoyer la commande")])],1)])])])]}}]),model:{value:e.isConfirmDialogOpen,callback:function(t){e.isConfirmDialogOpen=t},expression:"isConfirmDialogOpen"}})],2)])}),[],!1,null,"68c50bfb",null);"function"==typeof d&&d(u);t.default=u.exports},"twr/":function(e,t,o){"use strict";o("8pOP")}}]);